<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æƒ…æ›¸è±ªè¯ç‰ˆ - é–‹ç™¼è€…æ¸¬è©¦æ¨¡å¼</title>
    <style>
        /* CSSï¼šè² è²¬ç•«é¢çš„å¤–è§€ */
        body { font-family: "Microsoft JhengHei", sans-serif; background-color: #f0f2f5; padding: 20px; }
        .container { max-width: 800px; margin: auto; background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        
        .setup-section { background: #e9ecef; padding: 15px; border-radius: 8px; margin-bottom: 20px; text-align: center; }
        
        .game-info { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; font-weight: bold; color: #555; }

        /* ç©å®¶å€åŸŸä½ˆå±€ */
        .players-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px; margin-bottom: 20px; }
        .player-card { border: 2px solid #dee2e6; padding: 10px; border-radius: 8px; text-align: center; transition: 0.3s; }
        .player-card.active { border-color: #007bff; background-color: #e7f1ff; } /* è¼ªåˆ°è©²ç©å®¶æ™‚è®Šè‰² */
        .player-card.is-out { background-color: #f8d7da; color: #721c24; border-color: #f5c6cb; opacity: 0.6; }

        /* æŒ‰éˆ•æ¨£å¼ */
        button { padding: 8px 16px; cursor: pointer; border: none; border-radius: 4px; background-color: #007bff; color: white; font-size: 14px; transition: 0.2s; }
        button:hover { background-color: #0056b3; }
        button:disabled { background-color: #ccc; cursor: not-allowed; }

        /* éŠæˆ²æ—¥èªŒå€ */
        #log { background: #343a40; color: #d1d1d1; height: 180px; overflow-y: auto; padding: 10px; border-radius: 4px; font-family: monospace; font-size: 13px; line-height: 1.5; }
        .log-new { color: #52ff52; } /* æ–°è¨Šæ¯é¡è‰² */
    </style>
</head>
<body>

<div class="container">
    <h2>ğŸ’Œ æƒ…æ›¸è±ªè¯ç‰ˆ (32å¼µæ¸¬è©¦ç‰ˆ)</h2>

    <div class="setup-section">
        <label>éŠç©äººæ•¸ (2-8äºº)ï¼š</label>
        <input type="number" id="playerCount" value="4" min="2" max="8" style="width: 50px; padding: 5px;">
        <button onclick="startGame()">å•Ÿå‹•éŠæˆ²</button>
    </div>

    <div id="game-board" style="display: none;">
        <div class="game-info">
            <span>ç‰Œåº«å‰©é¤˜ï¼š<span id="deckCount">0</span> å¼µ</span>
            <span id="turnInfo">æº–å‚™ä¸­...</span>
        </div>

        <div class="players-grid" id="playerDisplay">
            </div>

        <div style="margin-bottom: 10px;">
            <strong>æ§åˆ¶å°ï¼š</strong>
            <button id="drawBtn" onclick="playerDraw()">æŠ½ä¸€å¼µç‰Œ (æ¸¬è©¦ç”¨)</button>
        </div>

        <div id="log"></div>
    </div>
</div>

<script>
    /**
     * è®Šæ•¸è¨­å®š
     */
    // 1. å¡ç‰Œé…ç½® (8ç¨®è§’è‰²ï¼Œå…±32å¼µ)
    const CARD_CONFIG = [
        { value: 8, name: "å…¬ä¸»", count: 2 },
        { value: 7, name: "ä¼¯çˆµå¤«äºº", count: 2 },
        { value: 6, name: "åœ‹ç‹", count: 2 },
        { value: 5, name: "ç‹å­", count: 4 },
        { value: 4, name: "ä¾å¥³", count: 4 },
        { value: 3, name: "ç”·çˆµ", count: 4 },
        { value: 2, name: "ç¥çˆ¶", count: 4 },
        { value: 1, name: "è¡›å…µ", count: 10 }
    ];

    let deck = [];        // è®Šæ•¸ï¼šç‰Œåº«é™£åˆ—
    let players = [];     // è®Šæ•¸ï¼šç©å®¶ç‰©ä»¶é™£åˆ— (å…§å«ç·¨è™Ÿã€èº«ä»½/æ‰‹ç‰Œ)
    let currentPlayer = 0; // è®Šæ•¸ï¼šç›®å‰è¼ªåˆ°å“ªå€‹ç·¨è™Ÿçš„ç©å®¶

    /**
     * éŠæˆ²é‚è¼¯ï¼šå•Ÿå‹•èˆ‡åˆå§‹åŒ–
     */
    function startGame() {
        const count = parseInt(document.getElementById('playerCount').value);
        if (count < 2 || count > 8) return alert("äººæ•¸éŒ¯èª¤ï¼");

        // A. åˆå§‹åŒ–ç‰Œåº«ï¼šæ ¹æ“šé…ç½®æŠŠ 32 å¼µç‰Œæ”¾é€²å»
        deck = [];
        CARD_CONFIG.forEach(card => {
            for (let i = 0; i < card.count; i++) {
                // æ¯å¼µç‰Œå­˜æˆä¸€å€‹ç‰©ä»¶ï¼Œæ–¹ä¾¿å¾ŒçºŒæ“´å……æ•ˆæœ
                deck.push({ name: card.name, value: card.value });
            }
        });

        // B. æ´—ç‰Œï¼šæ‰“äº‚é™£åˆ—é †åº
        deck.sort(() => Math.random() - 0.5);

        // C. åˆå§‹åŒ–ç©å®¶ï¼šå»ºç«‹ç©å®¶ç·¨è™Ÿèˆ‡åˆå§‹èº«åˆ†
        players = [];
        for (let i = 0; i < count; i++) {
            players.push({
                id: i,                    // ç©å®¶ç·¨è™Ÿ
                name: i === 0 ? "æˆ‘" : `ç©å®¶ ${i + 1}`, 
                hand: [deck.pop()],        // ç©å®¶èº«åˆ† (åˆå§‹ç™¼ä¸€å¼µ)
                isOut: false,             // æ˜¯å¦æ·˜æ±°
                isProtected: false        // ä¾å¥³ä¿è­·ç‹€æ…‹
            });
        }

        // D. é¡¯ç¤ºç•«é¢
        document.getElementById('game-board').style.display = 'block';
        addLog(`éŠæˆ²é–‹å§‹ï¼ç¸½å…± 32 å¼µç‰Œï¼Œ${count} ä½ç©å®¶å·²å°±ä½ã€‚`);
        currentPlayer = 0;
        renderUI();
    }

    /**
     * éŠæˆ²é‚è¼¯ï¼šæŠ½ç‰Œæ¸¬è©¦
     */
    function playerDraw() {
        if (deck.length === 0) {
            addLog("ç‰Œåº«å·²ç©ºï¼");
            return;
        }

        let p = players[currentPlayer];
        if (p.hand.length >= 2) {
            addLog(`${p.name} æ‰‹ç‰Œå·²æ»¿ï¼Œè«‹å…ˆå‡ºç‰Œã€‚`);
            return;
        }

        const newCard = deck.pop();
        p.hand.push(newCard);
        addLog(`${p.name} æŠ½åˆ°äº† [${newCard.name}]`);
        renderUI();
    }

    /**
     * ç•«é¢æ¸²æŸ“ï¼šå°‡è®Šæ•¸è³‡æ–™è½‰æ›æˆ HTML æ–‡å­—æŒ‰éˆ•
     */
    function renderUI() {
        // æ›´æ–°å‰©é¤˜å¼µæ•¸
        document.getElementById('deckCount').innerText = deck.length;
        document.getElementById('turnInfo').innerText = `ç¾åœ¨è¼ªåˆ°ï¼š${players[currentPlayer].name}`;

        const display = document.getElementById('playerDisplay');
        display.innerHTML = ''; // æ¸…ç©ºèˆŠå…§å®¹

        // å¹«æ¯å€‹ç©å®¶ç”¢ç”Ÿä¸€å€‹å¡ç‰‡å€å¡Š
        players.forEach((p, idx) => {
            const cardDiv = document.createElement('div');
            cardDiv.className = `player-card ${p.isOut ? 'is-out' : ''} ${idx === currentPlayer ? 'active' : ''}`;
            
            // è™•ç†æ‰‹ç‰Œé¡¯ç¤º (å°‡æ‰‹ç‰Œé™£åˆ—è½‰ç‚ºæŒ‰éˆ•æ–‡å­—)
            let handHtml = '';
            if (!p.isOut) {
                p.hand.forEach((card, cardIdx) => {
                    handHtml += `<button onclick="playCard(${idx}, ${cardIdx})" style="margin:2px">æ‰“å‡º ${card.name}</button><br>`;
                });
            } else {
                handHtml = '---';
            }

            cardDiv.innerHTML = `
                <strong>${p.name}</strong><br>
                èº«åˆ†ï¼š${p.isOut ? 'æ·˜æ±°' : 'éš±è—ä¸­'}<br>
                ${handHtml}
            `;
            display.appendChild(cardDiv);
        });
    }

    /**
     * éŠæˆ²é‚è¼¯ï¼šå‡ºç‰Œ (é»æ“ŠæŒ‰éˆ•å¾Œè§¸ç™¼)
     */
    function playCard(playerIdx, cardIdx) {
        if (playerIdx !== currentPlayer) {
            alert("é‚„æ²’è¼ªåˆ°ä½ ï¼");
            return;
        }

        // å¾ç©å®¶æ‰‹ä¸­ç§»é™¤è©²å¼µç‰Œ
        const playedCard = players[playerIdx].hand.splice(cardIdx, 1)[0];
        addLog(`${players[playerIdx].name} æ‰“å‡ºäº† [${playedCard.name}]`);

        // é€™è£¡å¯ä»¥æ ¹æ“š playedCard.value å¯«å„å¼µç‰Œçš„æ•ˆæœ (if/switch)
        if (playedCard.value === 8) {
            addLog(`${players[playerIdx].name} èª¤å‡ºäº†å…¬ä¸»ï¼Œç›´æ¥æ·˜æ±°ï¼`);
            players[playerIdx].isOut = true;
        }

        // ç°¡å–®åˆ‡æ›ä¸‹ä¸€ä½ç©å®¶ (è·³éå·²æ·˜æ±°çš„)
        do {
            currentPlayer = (currentPlayer + 1) % players.length;
        } while (players[currentPlayer].isOut);

        renderUI();
    }

    /**
     * è¼”åŠ©å·¥å…·ï¼šå¢åŠ æ—¥èªŒè¨Šæ¯
     */
    function addLog(msg) {
        const log = document.getElementById('log');
        const time = new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit', second: '2-digit' });
        log.innerHTML = `<div class="log-new">[${time}] ${msg}</div>` + log.innerHTML;
    }
</script>

</body>
</html>